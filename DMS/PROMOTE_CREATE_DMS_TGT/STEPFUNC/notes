paste this code into a lambda

it should look like this


in the configuration tab
the iam role should have:
dms admin perms
tts-promote-rr-role-ofgjnivd has what it needs

step function role in iam has:
AWSLambdaRole
tts-dms-admin
XRayAccessPolicy
to check this, Design/Code/Config to the right of the name of the step function,
Click Config
you will then see a drop down for an IAM role for Execution role
tts_stepfunctions:
amazon rds full
aws lambdarole
cloudwatchfull
tts-dms-admin


++ notes from the cft in the blog post

1. lambda - invoke modify endpoint lambda
config
state name - invoke modify endpoint lambda
integration type - optimized
function name - arn
payload - use state input as payload
next state - wait 60s
input 
all defaults
output
check filter output with OutputPath
$.Payload

configuration -> permissions
role name at the very top.
edit to change this to an iam role that has the perms that you need
tts-promote-rr-role-ofgjnivd - add dms/rds permissiosn to this

2. wait 60s

3. lambda - invoke describe connections lambda
output
check filter output with OutputPath
$.Payload

4. check connection status
rule 1 - $.connection_status == "successful"
rule 2 - $.connection_status == "testing"
rule 3 - $.connection_status == "failed" or $.connection_status == "deleting"
default rule

this connection_status string is in the lambda return 

input
all defaults
output 
all defaults




